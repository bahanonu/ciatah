<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Biafra Ahanonu">
  
  <link rel="shortcut icon" href="../img/favicon.ico">
<title>Spatial filtering</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link href="../css/extra.css" rel="stylesheet" />
  <link href="../css/pygments.css" rel="stylesheet" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Spatial filtering";
    var mkdocs_page_input_path = "help_spatial_filtering.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> CIAtah</a>
        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">End-to-end</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../all_docs/">One-page readme</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../all_docs/">One-page readme (auto)</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Setup</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../install/">Quick Start</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../install_alt/">Install</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../example_data/">Example data</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../dependencies/">Dependencies</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Repository</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../data/">Data formats</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../notes/">Notes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../organization/">Organization</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Processing imaging data</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_overview/">Overview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_all/">One-page step-by-step</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed/">One-page step-by-step (auto)</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_downsample_raw/">1| Downsample raw movies</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_preprocess_check/">2| Check pre-process settings</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_preprocess/">3| <u><strong>Processing imaging movies</strong></u></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_modify_movies/">4| Movie clean-up</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_signal_extraction/">5| <u><strong>Cell extraction</strong></u></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_signal_extraction_load/">6| Loading cell extraction outputs</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_signal_extraction_validation/">7| <u><strong>Cell extraction validation</strong></u></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_signal_sorting_manual/">8| <u><strong>Manual cell sorting</strong></u></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_signal_region_analysis/">9| Region-specific analysis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_cross_session/">10| <u><strong>Cross-session alignment</strong></u></a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Spinal cord motion correction</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_detailed_spinal/">Spinal cord motion correction</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Animal tracking</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../pipeline_animal_tracking/">Animal tracking (ImageJ+MATLAB)</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">API</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../api_example_pipeline/">Custom pipelines</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../api_ciapkg/">ciapkg</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Help</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../help_issues/">Issues and fixes</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../blank/"><div class='subsection1'>Data</div></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_inscopix/">Inscopix</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_nwb/">Neurodata Without Borders</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../blank/"><div class='subsection1'>Interface</div></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_contrast/">Movie display and noise</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../blank/"><div class='subsection1'>Analysis</div></a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_analysis_methods/">Analysis methods</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_large_movie_analysis/">Large movie analysis</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_stripe_removal/">Stripe removal</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_snr/">Improving signal-to-noise</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Spatial filtering</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#why-conduct-spatial-filtering">Why conduct spatial filtering?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#filtering-movies-with-normalizemovie">Filtering movies with normalizeMovie</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fft-bandpass-filtering">FFT bandpass filtering</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#divide-by-lowpass-filtering">Divide by lowpass filtering</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#images-from-unit-test">Images from unit test</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#main-filtering-functions">Main filtering functions.</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#test-function-filtering">Test function filtering</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#matlab-test-function">Matlab test function</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#matlab-test-function-movie-output">Matlab test function movie output</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#imagej-test-function">ImageJ test function</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#common-issues">Common Issues</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#dark-halos-around-cells">Dark halos around cells</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#comparison-of-matlab-and-imagej-fft-based-spatial-filtering">Comparison of MATLAB and ImageJ FFT-based spatial filtering</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_temporal_downsampling/">Temporal downsampling</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_motion_correction/">Motion correction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_cell_extraction/">Cell extraction</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_manual_cell_sorting/">Manual cell sorting</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_cross_session_alignment/">Cross-session alignemnt</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../help_animal_tracking/">Animal tracking</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Misc</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../acknowledgments/">Acknowledgments</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../references/">Cite</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../questions/">Questions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../license/">License</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">CIAtah</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Help &raquo;</li>
        
      
    
    <li>Spatial filtering</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="movie-filtering">Movie Filtering<a class="headerlink" href="#movie-filtering" title="Permanent link">&para;</a></h1>
<p>This page documents different features and functions in the CIAtah repository variable for filtering (spatial high/low/bandpass) movies to remove neuropil, cells, or other features.</p>
<p><img alt="2014_04_01_p203_m19_check01_spatialFilter" src="https://user-images.githubusercontent.com/5241605/111711340-af792480-8808-11eb-85d1-8c76479995bb.gif" /></p>
<h2 id="why-conduct-spatial-filtering">Why conduct spatial filtering?<a class="headerlink" href="#why-conduct-spatial-filtering" title="Permanent link">&para;</a></h2>
<p>Spatial filtering can have a large impact on the resulting cell activity traces extracted from the movies and can lead to erroneous conclusions if not properly applied during pre-processing.</p>
<p>For example, below are the correlations  between all cell-extraction outputs from PCA-ICA, ROI back-application of ICA filters, and CNMF-e on a miniature microscope one-photon movie. As can be seen, especially in the case of ROI analysis, the correlation between the activity traces is rendered artificially high due to the correlated background noise. This is greatly reduced in many instances after proper spatial filtering.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/5241605/111710928-e864c980-8807-11eb-9d29-81341290d108.png" /></p>
<p>(Chebychev clustering, n = 5 clusters)</p>
<!-- <hr> -->

<h2 id="filtering-movies-with-normalizemovie">Filtering movies with <code>normalizeMovie</code><a class="headerlink" href="#filtering-movies-with-normalizemovie" title="Permanent link">&para;</a></h2>
<p>Users can quickly filter movies using the <code>normalizeMovie</code> function. See below for usage.</p>
<div class="codehilite"><pre><span></span><code><span class="lineno" data-linenos=" 1 "></span><span class="c">% Load the movie (be in TIF, HDF5, AVI, etc.). Change HDF5 input dataset name as needed.</span>
<span class="lineno" data-linenos=" 2 "></span><span class="n">inputMovie</span> <span class="p">=</span> <span class="n">loadMovieList</span><span class="p">(</span><span class="s">&#39;pathToMovie&#39;</span><span class="p">,</span><span class="s">&#39;inputDatasetName&#39;</span><span class="p">,</span><span class="s">&#39;/1&#39;</span><span class="p">);</span> 
<span class="lineno" data-linenos=" 3 "></span>
<span class="lineno" data-linenos=" 4 "></span><span class="c">% Set options for dividing movie by lowpass version of the movie</span>
<span class="lineno" data-linenos=" 5 "></span><span class="n">options</span><span class="p">.</span><span class="n">freqLow</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="lineno" data-linenos=" 6 "></span><span class="n">options</span><span class="p">.</span><span class="n">freqHigh</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="lineno" data-linenos=" 7 "></span><span class="n">options</span><span class="p">.</span><span class="n">normalizationType</span> <span class="p">=</span> <span class="s">&#39;lowpassFFTDivisive&#39;</span><span class="p">;</span>
<span class="lineno" data-linenos=" 8 "></span><span class="n">options</span><span class="p">.</span><span class="n">waitbarOn</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="lineno" data-linenos=" 9 "></span><span class="n">options</span><span class="p">.</span><span class="n">bandpassMask</span> <span class="p">=</span> <span class="s">&#39;gaussian&#39;</span><span class="p">;</span>
<span class="lineno" data-linenos="10 "></span>
<span class="lineno" data-linenos="11 "></span><span class="c">% Options for normal bandpass filter</span>
<span class="lineno" data-linenos="12 "></span><span class="n">options</span><span class="p">.</span><span class="n">freqLow</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="lineno" data-linenos="13 "></span><span class="n">options</span><span class="p">.</span><span class="n">freqHigh</span> <span class="p">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="lineno" data-linenos="14 "></span><span class="n">options</span><span class="p">.</span><span class="n">normalizationType</span> <span class="p">=</span> <span class="s">&#39;fft&#39;</span><span class="p">;</span>
<span class="lineno" data-linenos="15 "></span><span class="n">options</span><span class="p">.</span><span class="n">waitbarOn</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="lineno" data-linenos="16 "></span><span class="n">options</span><span class="p">.</span><span class="n">bandpassMask</span> <span class="p">=</span> <span class="s">&#39;gaussian&#39;</span><span class="p">;</span>
<span class="lineno" data-linenos="17 "></span>
<span class="lineno" data-linenos="18 "></span><span class="c">% Set additional common options</span>
<span class="lineno" data-linenos="19 "></span><span class="n">options</span><span class="p">.</span><span class="n">showImages</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c">% Set to 1 if you want to view</span>
<span class="lineno" data-linenos="20 "></span>
<span class="lineno" data-linenos="21 "></span><span class="c">% Run analysis</span>
<span class="lineno" data-linenos="22 "></span><span class="n">inputMovie</span> <span class="p">=</span> <span class="n">normalizeMovie</span><span class="p">(</span><span class="n">single</span><span class="p">(</span><span class="n">inputMovie</span><span class="p">),</span><span class="s">&#39;options&#39;</span><span class="p">,</span><span class="n">options</span><span class="p">);</span>
</code></pre></div>
<p>If users set <code>options.showImages = 0;</code>, then <code>normalizeMovie</code> will update a figure containing both real and frequency space before and after the filter has been applied along with an example of the filter in frequency space. This allows users to get a sense of what their filter is doing. See below for examples.</p>
<!-- ![image](https://user-images.githubusercontent.com/5241605/111677991-049f4100-87dd-11eb-9bb6-1ba46894ea70.png) -->

<h3 id="fft-bandpass-filtering">FFT bandpass filtering<a class="headerlink" href="#fft-bandpass-filtering" title="Permanent link">&para;</a></h3>
<p>Bandpass filtering where only <code>red</code> frequencies in <code>filter</code> image (FFT of bottom left input image) are kept producing an image as in <code>fft image</code>.
<img alt="image" src="https://github.com/bahanonu/ciatah/assets/5241605/78fda2d7-a041-4622-a9b6-3b667f24bc49" /></p>
<h3 id="divide-by-lowpass-filtering">Divide by lowpass filtering<a class="headerlink" href="#divide-by-lowpass-filtering" title="Permanent link">&para;</a></h3>
<p>Another method is <code>lowpassFFTDivisive</code>, which involves dividing the image by a lowpass version of itself. In the below example, the <code>filter</code> image shows that only low frequencies will be kept. This will produce an image as in <code>fft image</code> that when divided or subtracted from the <code>input image</code> will produce <code>difference</code> image.
<img alt="image" src="https://github.com/bahanonu/ciatah/assets/5241605/cde8556b-e009-4e92-b28f-b277f331a9a5" /></p>
<h2 id="images-from-unit-test">Images from unit test<a class="headerlink" href="#images-from-unit-test" title="Permanent link">&para;</a></h2>
<h3 id="main-filtering-functions">Main filtering functions.<a class="headerlink" href="#main-filtering-functions" title="Permanent link">&para;</a></h3>
<p>Below is a screen grab from a random frame using all the filtering functions. A nice way to quickly see the many differences between each functions filtering.</p>
<!-- ![image](https://user-images.githubusercontent.com/5241605/32477562-18b7d9d4-c334-11e7-988f-accdf99a22f2.png) -->

<p><img alt="image" src="https://github.com/bahanonu/ciatah/assets/5241605/51356dea-deb6-4bbe-904b-2a79577ffcdf" /></p>
<h3 id="test-function-filtering">Test function filtering<a class="headerlink" href="#test-function-filtering" title="Permanent link">&para;</a></h3>
<p>This function will take a movie and conduct multiple spatial filtering operations on it then display for the user. </p>
<!-- This is currently only for the Matlab fft, but I'll see about expanding to others. -->

<div class="codehilite"><pre><span></span><code><span class="lineno" data-linenos="1 "></span><span class="n">ciapkg</span><span class="p">.</span><span class="n">unit</span><span class="p">.</span><span class="n">unitNormalizeMovie</span><span class="p">;</span>
</code></pre></div>
<p>After running that function, below is an example movie from a prefrontal cortex animal (miniature microscope, GCaMP) showing the difference in results with different spatial filtering.</p>
<p><img alt="image" src="https://github.com/bahanonu/ciatah/assets/5241605/a09e959e-da75-49c3-8c89-7ee1e42ac004" /></p>
<h3 id="matlab-test-function">Matlab test function<a class="headerlink" href="#matlab-test-function" title="Permanent link">&para;</a></h3>
<p>I've also added the ability to test the parameter space of the Matlab fft, use the below command.</p>
<div class="codehilite"><pre><span></span><code><span class="lineno" data-linenos="1 "></span><span class="n">testMovieFFT</span> <span class="p">=</span> <span class="n">normalizeMovie</span><span class="p">(</span><span class="n">testMovie</span><span class="p">,</span><span class="s">&#39;normalizationType&#39;</span><span class="p">,</span><span class="s">&#39;matlabFFT_test&#39;</span><span class="p">,</span><span class="s">&#39;secondaryNormalizationType&#39;</span><span class="p">,</span><span class="s">&#39;lowpassFFTDivisive&#39;</span><span class="p">,</span><span class="s">&#39;bandpassMask&#39;</span><span class="p">,</span><span class="s">&#39;gaussian&#39;</span><span class="p">,</span><span class="s">&#39;bandpassType&#39;</span><span class="p">,</span><span class="s">&#39;lowpass&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Should get a movie output similar to the below, where there is the original movie, the FFT movie, the original/FFT movie, and the dfof of original/FFT movie.</p>
<p><img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11490967/559152e2-9792-11e5-839b-a93811df70ce.png" /></p>
<p>This can also be expanded to look at the effects of different spatial frequency filters on the resulting output, as indicated below.</p>
<p><img alt="image" src="https://user-images.githubusercontent.com/5241605/32477571-26620546-c334-11e7-8ce0-aa5269fcb5f3.png" /></p>
<h3 id="matlab-test-function-movie-output">Matlab test function movie output<a class="headerlink" href="#matlab-test-function-movie-output" title="Permanent link">&para;</a></h3>
<p>Similar to above, showing results when using <code>lowpassFFTDivisive</code> normalization (using the <code>matlab divide by lowpass before registering</code> option in <code>modelPreprocessMovie</code> and <code>viewMovieRegistrationTest</code> functions) with <code>freqLow = 0</code> and <code>freqHigh</code> set to <code>1</code>, <code>4</code>, and <code>20</code>. This corresponds to removing increasingly smaller features from the movie.</p>
<!-- 2014_04_01_p203_m19_check01_fft_example-3 -->
<!-- ![image](https://user-images.githubusercontent.com/5241605/71422606-aec30400-2640-11ea-8ffb-41cdeea771c1.gif) -->

<!-- ![image](https://github.com/bahanonu/ciatah/assets/5241605/c6ffeb2b-db03-413c-8a58-e35e3543e5db) -->

<p><img alt="image" src="https://github.com/bahanonu/ciatah/assets/5241605/2534544b-7519-4d17-b4f5-088ee5582a87" /></p>
<h3 id="imagej-test-function">ImageJ test function<a class="headerlink" href="#imagej-test-function" title="Permanent link">&para;</a></h3>
<p>To test the ImageJ FFT and determine the best parameters for a given set of movies, run the following function on a test movie matrix:
<div class="codehilite"><pre><span></span><code><span class="lineno" data-linenos="1 "></span><span class="n">inputMovieTest</span> <span class="p">=</span> <span class="n">normalizeMovie</span><span class="p">(</span><span class="n">inputMovie</span><span class="p">,</span><span class="s">&#39;normalizationType&#39;</span><span class="p">,</span><span class="s">&#39;imagejFFT_test&#39;</span><span class="p">);</span>
</code></pre></div></p>
<p>The output should look like the below:
<img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11154743/14dd385a-89f6-11e5-8d56-c349e8c4f3f8.png" /></p>
<!-- <hr> -->

<h2 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h2>
<p>A list of some common issues.</p>
<h3 id="dark-halos-around-cells">Dark halos around cells<a class="headerlink" href="#dark-halos-around-cells" title="Permanent link">&para;</a></h3>
<p>If the spatial filter is not properly configured then dark halos will appear around high SNR cells, potentially obscuring nearby, low SNR cells.
<img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11329062/1232a886-914b-11e5-9cca-85ec6162319b.png" /></p>
<!-- https://github.com/schnitzer-lab/miniscope_analysis/pull/30 -->

<ul>
<li>FYI, for 4x downsampled movies, <code>highFreq</code> parameter of 4 (which corresponds to a <code>fspecial</code> gaussian with std of 4) produces the closest results to ImageJ <code>Process-&gt;FFT-&gt;Bandpass Filter...</code> with inputs of <code>filter_large=10000 filter_small=80 suppress=None tolerance=5</code> (the current default in <code>normalizeMovie</code>).</li>
</ul>
<h3 id="comparison-of-matlab-and-imagej-fft-based-spatial-filtering">Comparison of MATLAB and ImageJ FFT-based spatial filtering<a class="headerlink" href="#comparison-of-matlab-and-imagej-fft-based-spatial-filtering" title="Permanent link">&para;</a></h3>
<ul>
<li>Example frame from ImageJ and Matlab FFTs.
<img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11519196/fbcd561e-984c-11e5-95b9-3a23085c2e44.png" /></li>
</ul>
<ul>
<li>Distribution of pixel differences between ImageJ and Matlab FFT movies.
<img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11519037/8bcae88c-984b-11e5-84dd-097c61ccd756.png" /></li>
</ul>
<ul>
<li>This matches the filter that ImageJ says it uses, which is fairly close to the Matlab filter.
<img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11519329/22b3af8e-984e-11e5-9379-5b5d4092cee0.png" /></li>
</ul>
<p><strong>Example video: Basolateral amygdala miniature microscope imaging in open field</strong></p>
<!-- 2015_11_25_p384_m610_openfield01 -->

<ul>
<li>Below is an example comparison using the following Matlab commands to produce the filtered inputs:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="lineno" data-linenos="1 "></span><span class="n">testMovieFFT</span> <span class="p">=</span> <span class="n">normalizeMovie</span><span class="p">(</span><span class="n">testMovie</span><span class="p">,</span><span class="s">&#39;normalizationType&#39;</span><span class="p">,</span><span class="s">&#39;lowpassFFTDivisive&#39;</span><span class="p">,</span><span class="s">&#39;freqHigh&#39;</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>
<span class="lineno" data-linenos="2 "></span><span class="n">testMovieFFTImageJ</span> <span class="p">=</span> <span class="n">normalizeMovie</span><span class="p">(</span><span class="n">testMovie</span><span class="p">,</span><span class="s">&#39;normalizationType&#39;</span><span class="p">,</span><span class="s">&#39;imagejFFT&#39;</span><span class="p">);</span>
<span class="lineno" data-linenos="3 "></span><span class="n">diffMovie</span> <span class="p">=</span> <span class="n">testMovieFFT</span><span class="o">-</span><span class="n">testMovieFFTImageJ</span> <span class="p">;</span>
</code></pre></div>
<ul>
<li>With some tweaking of the <code>freqHigh</code> and other parameters, should hopefully be able to get closer to macheps and say that the two are identical for our purposes.</li>
</ul>
<p><img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11490643/618983b0-978f-11e5-944c-14c049d9d17e.png" /></p>
<ul>
<li>This is the histogram of the difference movie (Matlab - ImageJ). Notice most of the values are centered around zero with stdev ~0.2% df/f.
<img alt="image" src="https://cloud.githubusercontent.com/assets/5241605/11490647/68fbc8a6-978f-11e5-985d-1f07101840de.png" /></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../help_temporal_downsampling/" class="btn btn-neutral float-right" title="Temporal downsampling">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../help_snr/" class="btn btn-neutral" title="Improving signal-to-noise"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../help_snr/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../help_temporal_downsampling/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
